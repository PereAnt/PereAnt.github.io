<!DOCTYPE html>
<html>
    
    
    <head>
        <title>Visor complejo - Práctica visualización online Máster TIG - Pere Antoni</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href= "w3.css">
        <!-- enlace a CSS de Leaflet v. 1.6.0 en la cabecera -->
        <link rel="stylesheet" href="LEAFLET/codigo/leaflet.css"/>

        <!-- enlace a JavaScript de Leaflet v. 1.6.0 (justo tras CSS) -->
        <script src="LEAFLET/codigo/leaflet.js"></script> 
        
        <!-- enlace a la capa GeoJson de municipios-->
        <script src="LAYERS/municipios_poblacion.js"></script>
        
        <style>
            body {
                padding: 0;
                margin: 0;
            }

            html, body, map {
                height: 100%;
                width: 100%;
                font: 10pt "sans-serif";
            }
        </style>
    </head>

    <body>
        <div class= "w3-panel w3-light-gray w3-margin-left w3-margin-right"> 
            <h1 class="w3-center w3-wide w3-xlarge w3-text" style="text-shadow:1px 1px 0 #444">Visor creado por Pere A Matías Florit </h1>
        </div>
        <div id="mapa" style="width: 98%; height: 90%" class="w3-container w3-card w3-white w3-margin-left w3-margin-bottom w3-margin-top w3-margin-right w3-margin-left"></div>
        <script>
            // definimos el mapa como una variable y le ajustamos dónde lo queremos ver
            var visor = L.map('mapa').setView([39.758872, 2.984116], 8);
            
            var OSM_mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            });
             OSM_mapnik.addTo(visor);

            // codigo para añadir PNOA

            var PNOA = L.tileLayer.wms('http://www.idee.es/wms/PNOA/PNOA?', { //URL WMS
            layers: 'PNOA', // capa del WMS
            format: 'image/png', // tipo de formato
            transparent: true, // activa capa alfa/transparente
            attribution: ' <i>Imagen PNOA</i> &copy; IGN'
            });
            PNOA.addTo(visor); // añadir capa al mapa

            var topografico_5000 = L.tileLayer.wms('http://ideib.caib.es/pub_ideib/public/TOPOGRAFIC_5M_IB95/MapServer/WMSServer', {
                format: 'image/png',
                transparent: true,
                attribution: '<i> Topográfico escala 5000 </i> &copy; SITIBSA ' 
            });
            

            //cargo un archivo GeoJson con la población de los municipios de mallorca
            function Color(p) {            //antes de nada definimos con un función un color para cada rango de numero de habitantes
                return p > 60000 ? '#99000d' : //la escala de color la he "creado" en la página Color Brewer
                    p > 30000  ? '#cb181d' :  
                    p > 25000  ? '#ef3b2c' :
                    p > 20000  ? '#fb6a4a' :
                    p > 10000  ? '#fc9272' :
                    p > 5000  ? '#fcbba1' :
                    p > 1000   ? '#fee0d2' :
                    p < 1000   ? '#fff5f0' :
                                '#000000';
            };
            //ahora definimos un estilo y especificamos que aplica la función anterior al campo población de la capa GeoJson
            function estilo (feature) {
                return {
                    fillColor: Color(feature.properties.MAX_poblacion),  //hacemos la llamada a la función anterior
                    weight: 2,                                           //aunque ponga MAX_población son datos "normales" de población
                    opacity: 1,
                    color: "gray",
                    fillOpacity: 1
                };
            }
            var municipios = L.geoJson(municipios, {style: estilo});  //ahora cuando creamos la variable hacemos la llamada al estilo creado
                                                                        //así representamos datos de población
            


            // añadimos marcadores de algunos asentamientos urbanos con un pequeño texto
            var buger = L.marker([39.76, 2.98]).bindPopup('Esto es Búger, mi pueblo.'),  //la segunda parte de estas lineas son el texto que aparece al clicar el marcador
                sapobla = L.marker([39.77, 3.02]).bindPopup('Esto es Sa Pobla, principal zona agrícola.'),
                palma = L.marker([39.57, 2.65]).bindPopup('Esto es Palma, la capital.'),
                manacor = L.marker([39.57, 3.21]).bindPopup('Esto es Manacor.'),
                alcudia = L.marker([39.84, 3.13]).bindPopup('Esto es Alcúdia');

            var pueblos = L.layerGroup([sapobla, buger, palma, manacor, alcudia]); //creo una unica capa con los marcadores para añadirlo al desplegable a continuación
            
             
            
            
        
        //Añadiendo controles

      //La capas base
            var baseMaps = {                  
            "OpenStreetMap": OSM_mapnik,  // Defino mi mapa base         
            };
            var overlayMaps = {           // A partir de aquí añado las diferentes capas del mapa
            "Ortofoto PNOA": PNOA, 
            "Topográfico 5000": topografico_5000, //el servicio WMS de Baleares falla mucho
            "Pueblos": pueblos,     // la capa "grupo" de pueblos 
            "Población Municipios Mallorca": municipios, // la capa GeoJson
            
            };
            //Los controles
            var capas = L.control.layers(   // variable con control de capas
            baseMaps,                     // añadiendo capas base
            overlayMaps,                  // añadiendo capas
            {collapsed:true});            // control NO desplegado
            capas.addTo(visor);           // añadimos control de capas al mapa

            //añadimos una escala y la situamos en la esquina izquierda
            var escala = L.control.scale({
            imperial: false,
            position: 'topleft'})
            escala.addTo(visor);

            
        
        </script>
        
    

    </body>




</html>